<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<meta name="copyright" content="Copyright Â© 2024 World Meteorological Organization (WMO)">
<title>WIS2 Cookbook</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book">
<div id="header">
<h1>WIS2 Cookbook</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock"><strong class="big">World Meteorological Organization</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">Date: 2025-10-10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">Version: 0.1.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">Document status: DRAFT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">Document location: <a href="https://wmo-im.github.io/wis2-cookbook/cookbook/wis2-cookbook-DRAFT.html" class="bare">https://wmo-im.github.io/wis2-cookbook/cookbook/wis2-cookbook-DRAFT.html</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">Standing Committee on Information Management and Technology (SC-IMT)<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">Commission for Observation, Infrastructure and Information Systems (INFCOM)<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">Copyright Â© 2024 World Meteorological Organization (WMO)</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_purpose">1.1. Purpose</a></li>
<li><a href="#_key_documents">1.2. Key documents</a></li>
<li><a href="#_publication_and_contribution">1.3. Publication and contribution</a></li>
</ul>
</li>
<li><a href="#_recipes_for_data_consumers">2. Recipes for data consumers</a>
<ul class="sectlevel2">
<li><a href="#_searching_the_global_discovery_catalogue">2.1. Searching the Global Discovery Catalogue</a>
<ul class="sectlevel3">
<li><a href="#_spatial_queries">2.1.1. Spatial queries</a></li>
<li><a href="#_temporal_queries">2.1.2. Temporal queries</a></li>
<li><a href="#_equality_queries">2.1.3. Equality queries</a></li>
<li><a href="#_freetext_search">2.1.4. Freetext search</a></li>
<li><a href="#_sorting">2.1.5. Sorting</a></li>
<li><a href="#_paging">2.1.6. Paging</a></li>
</ul>
</li>
<li><a href="#_finding_data_subscription_services_from_the_global_discovery_catalogue">2.2. Finding data subscription services from the Global Discovery Catalogue</a></li>
</ul>
</li>
<li><a href="#_recipes_for_data_publishers">3. Recipes for data publishers</a>
<ul class="sectlevel2">
<li><a href="#_validating_a_wis2_notification_message">3.1. Validating a WIS2 Notification Message</a></li>
<li><a href="#_publishing_a_wis2_notification_message_with_access_control">3.2. Publishing a WIS2 Notification Message with access control</a></li>
<li><a href="#_publishing_a_wis2_notification_message_with_embedded_data">3.3. Publishing a WIS2 Notification Message with embedded data</a></li>
<li><a href="#_publishing_a_wis2_notification_message_for_resource_deletion">3.4. Publishing a WIS2 Notification Message for resource deletion</a></li>
<li><a href="#_publishing_a_wmo_core_metadata_profile_record_for_retired_data">3.5. Publishing a WMO Core Metadata Profile record for retired data</a></li>
<li><a href="#_validating_a_wmo_core_metadata_profile_record">3.6. Validating a WMO Core Metadata Profile record</a></li>
<li><a href="#_subscribing_to_gdc_reports_of_wcmp2_validation_and_quality_assessment">3.7. Subscribing to GDC reports of WCMP2 validation and quality assessment</a></li>
<li><a href="#_advertising_client_side_filters_for_data_subscriptions_in_wcmp2_and_wnm">3.8. Advertising client side filters for data subscriptions in WCMP2 and WNM</a>
<ul class="sectlevel3">
<li><a href="#_example_surface_weather_observations">3.8.1. Example: Surface weather observations</a></li>
<li><a href="#_example_numerical_weather_prediction_based_forecast">3.8.2. Example: Numerical weather prediction based forecast</a></li>
</ul>
</li>
<li><a href="#_providing_a_requirements_specification_for_a_wis_2_0_node">3.9. Providing a requirements specification for a WIS 2.0 Node</a>
<ul class="sectlevel3">
<li><a href="#_wis_2_0_node_user_requirements_specifications">3.9.1. WIS 2.0 Node - User requirements specifications</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_recipes_for_earth_system_discipline_domain_experts">4. Recipes for Earth system discipline domain experts</a>
<ul class="sectlevel2">
<li><a href="#_defining_and_proposing_topic_for_wmo_earth_system_disciplines">4.1. Defining and proposing topic for WMO Earth system disciplines</a>
<ul class="sectlevel3">
<li><a href="#_core_levels">4.1.1. Core levels</a></li>
<li><a href="#_additional_earth_domain_specific_topics_levels">4.1.2. Additional Earth domain specific topics levels</a></li>
<li><a href="#_dos_and_donts_when_defining_earth_system_discipline_topics">4.1.3. Dos and don&#8217;ts when defining Earth system discipline topics</a></li>
</ul>
</li>
<li><a href="#_wcmp2_extensions_creating_earth_system_discipline_domain_specific_profiles_of_wcmp2">4.2. WCMP2 Extensions: creating Earth system discipline domain specific profiles of WCMP2</a>
<ul class="sectlevel3">
<li><a href="#_considerations_for_creating_a_wcmp2_extension">4.2.1. Considerations for creating a WCMP2 Extension</a></li>
<li><a href="#_how_to_create_a_wcmp2_extension">4.2.2. How to create a WCMP2 Extension</a></li>
</ul>
</li>
<li><a href="#_differences_in_wcmp2_records_with_extensions">4.3. Differences in WCMP2 records with Extensions</a></li>
</ul>
</li>
<li><a href="#_recipes_for_global_service_operators">5. Recipes for Global Service operators</a></li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_purpose"><a class="anchor" href="#_purpose"></a>1.1. Purpose</h3>
<div class="paragraph">
<p>In conjunction with the Manual on the WMO Information System volume II (WMO-No. 1060) (Manual on WIS volume II: WIS 2.0), the present Guide to the WMO Information System volume II (Guide to WIS volume II: WIS 2.0) is designed to ensure adequate uniformity and standardization in the data, information and communication practices, procedures and specifications employed by Members of the World Meteorological Organization (WMO) in the operation of the WMO Information System WIS 2.0 as it supports the mission of the Organization. The Manual on WIS contains standard and recommended practices, procedures and specifications. The Guide to WIS contains additional information concerning practices, procedures, and specifications that Members are invited to follow or implement in establishing and conducting their arrangements in compliance with the WMO Technical Regulations and in developing meteorological and hydrological services.</p>
</div>
<div class="paragraph">
<p>This cookbook provides various code snippets, recipes and workflow examples in support of WIS2 requirements.</p>
</div>
</div>
<div class="sect2">
<h3 id="_key_documents"><a class="anchor" href="#_key_documents"></a>1.2. Key documents</h3>
<div class="paragraph">
<p>WIS2 Manuals and Guides can be found at the following locations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://library.wmo.int/idurl/4/68731">Manual on the WMO Information System</a></p>
</li>
<li>
<p><a href="https://library.wmo.int/idurl/4/69130">Guide to the WMO Information System Volume II - WMO Information System 2.0</a></p>
</li>
<li>
<p><a href="https://library.wmo.int/idurl/4/69050">Provisions for the Transition from the WMO Information System (WIS) 1.0 and Global Telecommunication System to WIS 2.0</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_publication_and_contribution"><a class="anchor" href="#_publication_and_contribution"></a>1.3. Publication and contribution</h3>
<div class="paragraph">
<p>Updates to this cookbook will be published twice per year - in March and October.</p>
</div>
<div class="paragraph">
<p>All "recipes" published in this cookbook have been reviewed by experts from the INFCOM Standing Committee on Information Management and Technology (SC-IMT). Publication of a new release is approved by the Chair of SC-IMT.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The WIS2 Cookbook is not regulatory material and does not follow the approval and publication process for the WIS2 Manual and Guide.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The WIS2 community are invited to provide feedback on the "recipes" in this Cookbook and also to propose new recipes. Contributions should be made by raising issues in the <a href="https://github.com/wmo-im/wis2-cookbook/issues">wmo-im/wis2-cookbook GitHub repository</a>. Experts from SC-IMT will review suggestions with the aim to incorporate them into the next release of the WIS2 Cookbook.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recipes_for_data_consumers"><a class="anchor" href="#_recipes_for_data_consumers"></a>2. Recipes for data consumers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_searching_the_global_discovery_catalogue"><a class="anchor" href="#_searching_the_global_discovery_catalogue"></a>2.1. Searching the Global Discovery Catalogue</h3>
<div class="paragraph">
<p>The <a href="https://wmo-im.github.io/wis2-guide/guide/wis2-guide-APPROVED.html#_2_4_4_global_discovery_catalogue">Global Discovery Catalogue (GDC)</a> allows for a wide range of query predicates to search for data in WIS2 as per the OGC API - Records - Part 1: Core specification.</p>
</div>
<div class="paragraph">
<p>The GDC can be searched via the <code>/collections/wis2-discovery-metadata/items</code> endpoint.  This endpoint provides a number query parameters as described in the examples below.</p>
</div>
<div class="paragraph">
<p><strong>NOTE</strong>: examples below are not URL encoded for clarity / readability, but should be when interacting with the GDC.</p>
</div>
<div class="sect3">
<h4 id="_spatial_queries"><a class="anchor" href="#_spatial_queries"></a>2.1.1. Spatial queries</h4>
<div class="ulist">
<ul>
<li>
<p>search for metadata records of data in Canada: <code>bbox=-142,42,-52,84</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the format of <code>bbox</code> is comma-separated values in the following order:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>minimum longitude</p>
</li>
<li>
<p>minimum latitude</p>
</li>
<li>
<p>maximum longitude</p>
</li>
<li>
<p>maximum latitude</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_temporal_queries"><a class="anchor" href="#_temporal_queries"></a>2.1.2. Temporal queries</h4>
<div class="ulist">
<ul>
<li>
<p>search for metadata records updated since 29 July 2024: <code>datetime=2024-07-29/..</code></p>
</li>
<li>
<p>search for metadata records updated before 29 July 2024: <code>datetime=../2024-07-29</code></p>
</li>
<li>
<p>search for metadata records updated on 29 July 2024: <code>datetime=2024-07-29</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_equality_queries"><a class="anchor" href="#_equality_queries"></a>2.1.3. Equality queries</h4>
<div class="ulist">
<ul>
<li>
<p>search for metadata records whose title contains the terms hourly observations: <code>title=hourly observations</code></p>
</li>
<li>
<p>search for metadata records whose title contains the terms hourly or observations: <code>title=hourly | observations</code></p>
</li>
<li>
<p>search for metadata records for a specific contact organization <code>contacts.organization=Direction Generale de la MÃ©tÃ©orologie</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_freetext_search"><a class="anchor" href="#_freetext_search"></a>2.1.4. Freetext search</h4>
<div class="ulist">
<ul>
<li>
<p>search metadata records for temperature: <code>q=temperature</code></p>
</li>
<li>
<p>search metadata records for GRIB2 data: <code>q=GRIB2</code></p>
</li>
<li>
<p>search metadata records for any GRIB data: <code>q=*GRIB*</code></p>
</li>
<li>
<p>search metadata records for any GRIB data in Germany: <code>q=*GRIB* AND germany</code></p>
</li>
<li>
<p>search for either GRIB data or data in Europe with subscriptions to the MÃ©tÃ©o-France Global Broker: <code>q=(*GRIB* OR *Europe*) AND *globalbroker*</code></p>
</li>
<li>
<p>search for data from Belize with MQTT subscription capabilities: <code>q="cache/a/wis2/bz-nms"</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_sorting"><a class="anchor" href="#_sorting"></a>2.1.5. Sorting</h4>
<div class="ulist">
<ul>
<li>
<p>sort search results by title, ascending: <code>sortby=title</code></p>
</li>
<li>
<p>sort search results by title, descending: <code>sortby=-title</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_paging"><a class="anchor" href="#_paging"></a>2.1.6. Paging</h4>
<div class="ulist">
<ul>
<li>
<p>present search results 1-10: <code>limit=10</code></p>
</li>
<li>
<p>present search results 11-20: <code>limit=10&amp;offset=10</code></p>
</li>
<li>
<p>limit to 3 search results: <code>limit=3</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_finding_data_subscription_services_from_the_global_discovery_catalogue"><a class="anchor" href="#_finding_data_subscription_services_from_the_global_discovery_catalogue"></a>2.2. Finding data subscription services from the Global Discovery Catalogue</h3>
<div class="paragraph">
<p>The <a href="https://wmo-im.github.io/wis2-guide/guide/wis2-guide-DRAFT.html#_2_4_4_global_discovery_catalogue">Global Discovery Catalogue (GDC)</a> contains both real-time and non real-time data.  The <a href="https://wmo-im.github.io/wcmp2/standard/wcmp2-STABLE.html">WMO Core Metadata Profile (WCMP2)</a> allows for description of real-time data via its <a href="https://wmo-im.github.io/wcmp2/standard/wcmp2-STABLE.html#_1_19_links_and_distribution_information">distribution information</a>, which data publishers use to describe and define connectivity and subscription information for a given dataset.</p>
</div>
<div class="paragraph">
<p>A typical WCMP2 distribution link for data subscriptions can be found below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "rel": "items",
    "href": "mqtts://everyone:everyone@globalbroker.meteo.fr:8883",
    "channel": "origin/a/wis2/ca-eccc-msc/data/core/hydrology",
    "type": "application/geo+json",
    "title": "Data notifications"
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>channel</code> property represents WIS2 topic which can be used to subscribe to the <code>href</code> property (i.e. the MQTT address) of the Global Broker (GB).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Programmatically, a GDC client can query the catalogue and filter the results for real-time subscriptions in the following manner:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import requests

response = requests.get('https://wis2-gdc.weather.gc.ca/collections/wis2-discovery-metadata/items').json()


def is_wis2_subscription_link(link) -&gt; bool:
    if (link['href'].startswith('mqtt') and
            link.get('channel', '').startswith(('origin/a/wis2', 'cache/a/wis2'))):
        return True


for feature in response['features']:
    for link in feature['links']:
        if is_wis2_subscription_link(link):
            print('WIS2 subscription link')</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the <code>href</code> and <code>channel</code> properties of a matching link object, a client can connect and subscribe to data notifications for a given dataset.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recipes_for_data_publishers"><a class="anchor" href="#_recipes_for_data_publishers"></a>3. Recipes for data publishers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_validating_a_wis2_notification_message"><a class="anchor" href="#_validating_a_wis2_notification_message"></a>3.1. Validating a WIS2 Notification Message</h3>
<div class="paragraph">
<p>A <a href="https://wmo-im.github.io/wis2-notification-message">WIS2 Notification Message</a> provides a <a href="http://schemas.wmo.int/wnm">JSON Schema</a> which can be used by any programming language that supports JSON and JSON Schema validation.</p>
</div>
<div class="listingblock">
<div class="title">Using Python and check-jsonschema</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># install check-jsonschema Python Package from the Python Package Index (PyPI)
pip3 install check-jsonschema

# download WNM schema
curl -O http://schemas.wmo.int/wnm/1.0.0/schemas/wis2-notification-message-bundled.json

# run schema validation
check-jsonschema --schemafile wis2-notification-message-bundled.json /path/to/my/wnm.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/World-Meteorological-Organization/pywis-pubsub">pywis-pubsub</a> tool provides a test suite to validate a message against the WNM specification requirements, as well as a Python API for application integration.  Consult the pywis-pubsub README on GitHub for more information/examples.</p>
</div>
<div class="listingblock">
<div class="title">Using pywis-pubsub</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># install pywis-pubsub
pip3 install pywis-pubsub

# sync WIS2 notification schema
pywis-pubsub schema sync

# validate WNM against abstract test suite (file on disk)
pywis-pubsub ets validate /path/to/file.json

# validate WNM against abstract test suite (URL)
pywis-pubsub ets validate https://example.org/path/to/file.json</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_publishing_a_wis2_notification_message_with_access_control"><a class="anchor" href="#_publishing_a_wis2_notification_message_with_access_control"></a>3.2. Publishing a WIS2 Notification Message with access control</h3>
<div class="paragraph">
<p>Recommended data in WIS2 may be open or access controlled.  For data publication with access control implications, WNM provides a <code>security</code> object as part a link object.  The <code>security</code> object is defined using <a href="https://swagger.io/specification/#security-scheme-object">OpenAPI Security Scheme definitions</a>.</p>
</div>
<div class="listingblock">
<div class="title">Access control using HTTP Basic authentication</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "rel": "canonical",
  "type": "application/grib2",
  "href": "https://example.org/my/protected/data/nwp/12/003/20240805120000-air-temp-500.grib2",
  "security": {
    "default": {
      "type": "http",
      "scheme": "basic",
      "description": "Please contact us for access information"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Access control using an API key</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "rel": "canonical",
  "type": "application/geo+json",
  "href": "https://example.org/my/protected/data/nwp/12/003/20240805120000-air-temp-500.grib2",
  "security": {
    "default": {
      "type": "apiKey",
      "name": "api-key",
      "in": "query",
      "description": "Please see https://example.org/contact-us for more information"
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the child property under <code>security</code> (<code>default</code> in the examples above) can be any text or label.  We use <code>default</code> here as a convention</p>
</li>
<li>
<p>the <code>security.default.name</code> is the name of the API key parameter as defined by your API service</p>
</li>
<li>
<p>only properties defined in the OpenAPI Security Scheme definition are allowed.  Any additional properties will invalidate the WNM</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Of course, always ensure your WNM is valid (see <a href="#Validate a WIS2 Notification Message">[Validate a WIS2 Notification Message]</a> for more information).</p>
</div>
</div>
<div class="sect2">
<h3 id="_publishing_a_wis2_notification_message_with_embedded_data"><a class="anchor" href="#_publishing_a_wis2_notification_message_with_embedded_data"></a>3.3. Publishing a WIS2 Notification Message with embedded data</h3>
<div class="paragraph">
<p>A <a href="https://wmo-im.github.io/wis2-notification-message">WIS2 Notification Message</a> provides the ability to embed data as part of a notification (see the <a href="https://wmo-im.github.io/wis2-notification-message/standard/wis2-notification-message-STABLE.html#_1_15_properties_content">Properties / Content</a> section of the specification).</p>
</div>
<div class="paragraph">
<p>Providing embedded data for offers users the ability to access the data without the need to execute the additional step of downloading the data via the actionable link (see the <a href="https://wmo-im.github.io/wis2-notification-message/standard/wis2-notification-message-STABLE.html#_1_16_links">Links</a> section of the specification).</p>
</div>
<div class="paragraph">
<p>In some cases, a data publisher also prefer not to publish the corresponding actionable link to infrastructure (e.g. an HTTP or FTP server).</p>
</div>
<div class="paragraph">
<p>When the data publisher decides to not publish an actionable link and to rely exclusively on the embedded data feature, the data publisher will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>use <code>properties.content</code> object to provide the data</p>
</li>
<li>
<p>use <code>properties.cache=false</code> to instruct WIS2 Global Cache Services to not cache the data  (note: <code>properties.cache</code> is not required for recommended data, since recommended data is not cached by WIS2 Global Caches)</p>
</li>
<li>
<p>provide a link object whose <code>href</code> results in HTTP 204 (No Content)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To provide an HTTP 204 link, there a couple of options:</p>
</div>
<div class="paragraph">
<p><strong>Option 1: configure your web server to provide an endpoint that always returns 204</strong>:</p>
</div>
<div class="listingblock">
<div class="title">Nginx example configuration</div>
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console"># always return HTTP 204 when accessing /no-content-here
location /no-content-here/ {
  return 204;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Apache example configuration</div>
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console"># always return HTTP 204 when accessing /no-content-here
Redirect 204 no-content-here</code></pre>
</div>
</div>
<div class="paragraph">
<p>which then would result in the link object as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "href": "https://example.org/no-content-here",
    "rel": "canonical"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Option 2: use a service that provides HTTP responses as a service</strong>.  One such service is the <a href="https://http.codes">HTTP Response API</a>, which then would result in the link object as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "href": "https://http.codes/204",
    "rel": "canonical"
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Embedded data example:</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "id": "31e9d66a-cd83-4174-9429-b932f1abe1be",
    "conformsTo": [
        "http://wis.wmo.int/spec/wnm/1/conf/core"
    ],
    "type": "Feature",
    "geometry": {
        "type": "Point",
        "coordinates": [
            6.146255135536194,
            46.223296618227444
        ]
    },
    "properties": {
        "pubtime": "2022-03-20T04:50:18Z",
        "datetime": "2022-03-20T04:45:00Z",
        "integrity": {
            "method": "sha512",
            "value": "A2KNxvks...S8qfSCw=="
        },
        "cache": false,
        "data_id": "dataset/123/data-granule/UANT01_CWAO_200445___15103.bufr4",
        "metadata_id": "urn:wmo:md:ca-eccc-msc:observations.swob",
        "content": {
            "encoding": "utf-8",
            "value": "encoded bytes from the file",
            "size": 457
        }
    },
    "links": [
        {
            "href": "https://http.codes/204",
            "rel": "canonical"
        }
    ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For cases of publishing recommended data, the same approaches/example can be used, without the need to set <code>properties.cache</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_publishing_a_wis2_notification_message_for_resource_deletion"><a class="anchor" href="#_publishing_a_wis2_notification_message_for_resource_deletion"></a>3.4. Publishing a WIS2 Notification Message for resource deletion</h3>
<div class="paragraph">
<p>A <a href="https://wmo-im.github.io/wis2-notification-message">WIS2 Notification Message</a> provides the ability to publish notifications for new, updated or deleted data and metadata (see the <a href="https://wmo-im.github.io/wis2-notification-message/standard/wis2-notification-message-STABLE.html#_1_16_links">Links</a> section of the specification).</p>
</div>
<div class="paragraph">
<p>Similar to the <a href="#_publishing_a_wis2_notification_message_with_embedded_data">embedded data Recipe</a>, for data or metadata deletions (core or recommended data), a data publisher may not wish to manage or publish the data or metadata link to infrastructure to an HTTP or FTP server.</p>
</div>
<div class="paragraph">
<p>In this case, a similar strategy can be used to provide an HTTP 204 No Content link, as per the <a href="#_publishing_a_wis2_notification_message_with_embedded_data">embedded data Recipe</a>, along with setting <code>rel=deletion</code> in the link object.</p>
</div>
<div class="listingblock">
<div class="title">Resource deletion example:</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "id": "31e9d66a-cd83-4174-9429-b932f1abe1be",
    "conformsTo": [
        "http://wis.wmo.int/spec/wnm/1/conf/core"
    ],
    "type": "Feature",
    "geometry": {
        "type": "Point",
        "coordinates": [
            6.146255135536194,
            46.223296618227444
        ]
    },
    "properties": {
        "pubtime": "2022-03-20T04:50:18Z",
        "datetime": "2022-03-20T04:45:00Z",
        "integrity": {
            "method": "sha512",
            "value": "A2KNxvks...S8qfSCw=="
        },
        "cache": false,
        "data_id": "dataset/123/data-granule/UANT01_CWAO_200445___15103.bufr4",
        "metadata_id": "urn:wmo:md:ca-eccc-msc:observations.swob"
    },
    "links": [
        {
            "href": "https://http.codes/204",
            "rel": "deletion"
        }
    ]
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_publishing_a_wmo_core_metadata_profile_record_for_retired_data"><a class="anchor" href="#_publishing_a_wmo_core_metadata_profile_record_for_retired_data"></a>3.5. Publishing a WMO Core Metadata Profile record for retired data</h3>
<div class="paragraph">
<p>The primary target for WCMP2 records is for real-time or archive data discovery, access and visualization, with the understanding that a dataset (and its associated discovery metadata) is properly managed and kept up to date.  In certain cases, datasets may become unavailable; this could mean that the dataset lifecycle has reached end of life, and/or no longer maintained.</p>
</div>
<div class="paragraph">
<p>An "end of life" or retired dataset should be independent from its description.  That is, even if a dataset is retired, there is value in having discovery metadata for these datasets, and so the WCMP2 record associated with it should not be deleted from the WIS2 Global Discovery Catalogues.  The FAIR Data Principles (A2) also state that metradata should persist even the data are no longer sustained <sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>To describe a retired dataset in WCMP2, one can use the <code>properties.status</code> object as per below:</p>
</div>
<div class="listingblock">
<div class="title">Describing a retired dataset in WCMP2</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"properties": {
  "status": {
    "id": "retired",
    "title": "Retired",
    "url": "https://standards.iso.org/iso/19115/-3/mcc/1.0/codelists.xml#MD_ProgressCode_retired"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above status is defined by <a href="https://www.iso.org/standard/80874.html">ISO 19115-3</a> as "<em>item is no longer recommended for use. It has not been superseded by another item</em>" <sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>Another aspect to consider reviewing all links in the WCMP2 record (<code>links</code> object).  For example, MQTT links can be removed, and any links which no longer provide the data can also be removed.  If the data is retired and has alternative access mechanisms (email, web form), these links can be added to the record.</p>
</div>
</div>
<div class="sect2">
<h3 id="_validating_a_wmo_core_metadata_profile_record"><a class="anchor" href="#_validating_a_wmo_core_metadata_profile_record"></a>3.6. Validating a WMO Core Metadata Profile record</h3>
<div class="paragraph">
<p>The <a href="https://github.com/World-Meteorological-Organization/pywcmp">pywcmp</a> tool provides a test suite to validate a message against the WCMP2 specification requirements, as well as a Python API for application integration.  Consult the pywcmp README on GitHub for more information/examples.</p>
</div>
<div class="listingblock">
<div class="title">Using pywcmp for WCMP2 validation</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># install pywcmp
pip3 install pywcmp

# sync WCMP2 schemas and codelists
pywcmp bundle sync

# validate WCMP2 against abstract test suite (file on disk)
pywcmp ets validate /path/to/file.json

# validate WCMP2 against abstract test suite (URL)
pywcmp ets validate https://example.org/path/to/file.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>A WCMP2 record can also be validated using pywcmp "as a service" using the Canadian and German WIS2 Global Discovery Catalogues, which provide an online validator:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Navigate to <a href="https://wis2-gdc.weather.gc.ca/openapi?f=html" class="bare">https://wis2-gdc.weather.gc.ca/openapi?f=html</a> or <a href="https://wis2.dwd.de/gdc/openapi?f=html" class="bare">https://wis2.dwd.de/gdc/openapi?f=html</a></p>
</li>
<li>
<p>Navigate to section <strong>pywcmp-wis2-wcmp2-ets</strong>, endpoint <code>/processes/pywcmp-wis2-wcmp2-ets/execution</code> (POST)</p>
</li>
<li>
<p>Click "Try it out"</p>
</li>
<li>
<p>In the section "Mandatory execute request JSON", paste the WCMP2 JSON inside the <code>record</code> object</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/data-publishers-wcmp2-validate-request-copy-paste.png" alt="WIS2 GDC online validator" width="request via WCMP2 copy/paste">
</div>
<div class="title">Figure 1. WIS2 GDC online validator, request via WCMP2 copy/paste</div>
</div>
<div class="paragraph">
<p>Alternatively, the validator service also accepts a URL (if the WCMP2 record is online):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/data-publishers-wcmp2-validate-request-url.png" alt="WIS2 GDC online validator" width="request via WCMP2 URL">
</div>
<div class="title">Figure 2. WIS2 GDC online validator, request via WCMP2 URL</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click "Execute"</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/data-publishers-wcmp2-validate-response.png" alt="WIS2 GDC online validator" width="response">
</div>
<div class="title">Figure 3. WIS2 GDC online validator, response</div>
</div>
<div class="paragraph">
<p>A response will be provided with validation results.</p>
</div>
<div class="paragraph">
<p>The WCMP2 standard also has <a href="https://wmo-im.github.io/wcmp2/kpi/wcmp2-kpi-DRAFT.html">(draft) Key Performance Indicators</a> that provide quality assessment in support of continuous improvement of WCMP2 records.  pywcmp additionally implements these KPIs using a similar workflow.</p>
</div>
<div class="listingblock">
<div class="title">Using pywcmp for WCMP2 quality assessment</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># validate WCMP2 against abstract test suite (file on disk)
pywcmp kpi validate /path/to/file.json

# validate WCMP2 against abstract test suite (URL)
pywcmp kpi validate https://example.org/path/to/file.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>The KPI check performs actions such as checking for healthy/working links and acronym checks, length of titles and more.  Note that the KPI results do not affect WCMP2 compliance but are suggestions on how to improve your WCMP2 record for better discoverability and use.</p>
</div>
<div class="paragraph">
<p>The Canadian and German WIS2 Global Discovery Catalogues also provide this functionality online in a similar fashion as the validator.:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/data-publishers-wcmp2-quality-assess-request-url.png" alt="WIS2 GDC quality assessment checker" width="request via WCMP2 URL">
</div>
<div class="title">Figure 4. WIS2 GDC quality assessment checker, request via WCMP2 URL</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/data-publishers-wcmp2-quality-assess-response.png" alt="WIS2 GDC online quality assessment checker" width="response">
</div>
<div class="title">Figure 5. WIS2 GDC quality assessment checker, response</div>
</div>
<div class="paragraph">
<p>A response will be provided with quality assessment results (in a similar format to the validation report).</p>
</div>
</div>
<div class="sect2">
<h3 id="_subscribing_to_gdc_reports_of_wcmp2_validation_and_quality_assessment"><a class="anchor" href="#_subscribing_to_gdc_reports_of_wcmp2_validation_and_quality_assessment"></a>3.7. Subscribing to GDC reports of WCMP2 validation and quality assessment</h3>
<div class="paragraph">
<p>When a WIS2 Node publishes a WCMP2 record, GDCs perform validaation according to the WCMP2 <a href="https://wmo-im.github.io/wcmp2/standard/wcmp2-STABLE.html#_conformance_class_abstract_test_suite_normative">Abstract Test Suite</a>).  If the record is compliant, a GDC will ingest and publish the record.  In addition, a GDC may provide additional quality assessment testing based on the <a href="https://wmo-im.github.io/wcmp2/kpi/wcmp2-kpi-DRAFT.html">(draft) WCMP2 Key Performance Indicators (KPIs)</a>.</p>
</div>
<div class="paragraph">
<p>GDC reports are made available as part of the <a href="https://wmo-im.github.io/wis2-monitoring-events/standard/wis2-monitoring-events-DRAFT.html">(draft) WIS2 Monitoring Events specification (WME)</a> and can be found by subscribing to a Global Broker using the topic <code>monitor/a/wis2/GDC_CENTRE_ID/WIS2NODE_CENTRE_ID</code>, where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>GDC_CENTRE_ID</code> is the centre identifier of a given GDC</p>
</li>
<li>
<p><code>WIS2NODE_CENTRE_ID</code> is the centre identifier of a given WIS2 Node</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, to subscribe to Canada GDC reports on WCMP2 records published by Japan Meteorological Agency (JMA), one would subscribe to the topic <code>monitor/a/wis2/ca-eccc-msc-global-discovery-catalogue/jp-jma</code>.</p>
</div>
<div class="paragraph">
<p>Message payloads are based on WME Message Encoding (WMEM), with a <code>data</code> payload of the WCMP2 ETS/KPI reports.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/data-publishers-monitor-gdc-wcmp2-reports.png" alt="WIS2 subscription to GDC reports of WCMP2 validation and quality assessment">
</div>
<div class="title">Figure 6. WIS2 subscription to GDC reports of WCMP2 validation and quality assessment</div>
</div>
</div>
<div class="sect2">
<h3 id="_advertising_client_side_filters_for_data_subscriptions_in_wcmp2_and_wnm"><a class="anchor" href="#_advertising_client_side_filters_for_data_subscriptions_in_wcmp2_and_wnm"></a>3.8. Advertising client side filters for data subscriptions in WCMP2 and WNM</h3>
<div class="paragraph">
<p>A key concept of a WCMP2 record is "actionable links"; this means being able to access a dataset or data granule
without any further interactions.  For real-time data, a WCMP2 record provides linkages to the WIS2 Global Broker
via the MQTT protocol.  At its core, MQTT has two key components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>topic: the topic to subscribe to</p>
</li>
<li>
<p>message payload: the message provided as part of a notification to a given topic</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>WIS2 defines the WIS2 Topic Hierarchy (WTH) and WIS2 Notification Message (WNM) standards which provide a standards-based
GeoJSON payload/message.</p>
</div>
<div class="paragraph">
<p>A typical MQTT link in a WCMP2 document is defined as follows:</p>
</div>
<div class="listingblock">
<div class="title">Typical WCMP2 MQTT link</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "rel"  : "items",
  "type" : "application/geo+json",
  "title": "WIS2 notification service",
  "href" : "mqtts://example.org",
  "channel": "cache/a/wis2/ca-eccc-msc/data/core/weather/surface-based-observations/synop"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given WCMP2, WTH and WNM, a user can subscribe to topics related to data of interest for download and access.</p>
</div>
<div class="paragraph">
<p>In some cases, a dataset may be organized in a manner which requires additional further "filtering" such that a
data consumer is only interested in a certain subset of the data granules being advertised by a given WNM.  Some examples include (but are not limited to), where a data consumer may be only be interested in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>surface weather observations from a certain station, or</p>
</li>
<li>
<p>numerical weather prediction forecast data for a certain timestep or weather parameter</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To implement this behaviour, add additional properties to both WCMP2 and WNM as follows:</p>
</div>
<div class="sect3">
<h4 id="_example_surface_weather_observations"><a class="anchor" href="#_example_surface_weather_observations"></a>3.8.1. Example: Surface weather observations</h4>
<div class="listingblock">
<div class="title">Surface weather observations: WCMP2 MQTT link with additional properties</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "rel"  : "items",
  "type" : "application/geo+json",
  "title": "Real-time notifications",
  "href" : "mqtts://globalbroker.meteo.fr:8883",
  "channel": "cache/a/wis2/ca-eccc-msc/data/core/weather/surface-based-observations/synop",
  "properties": {
    "wigos_station_identifier": {
       "type": "string",
       "title": "WIGOS station identifier"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Surface weather observations: WNM additional properties</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "properties": {
    "wigos_station_identifier": "0-20000-0-71628"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When implemented by a data producer, a data consumer can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>subscribe to real-time notifications to the given topic</p>
</li>
<li>
<p>perform client side filtering by against all incoming WNMs with <code>properties.wigos_station_identifier = "0-20000-0-71628"</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_example_numerical_weather_prediction_based_forecast"><a class="anchor" href="#_example_numerical_weather_prediction_based_forecast"></a>3.8.2. Example: Numerical weather prediction based forecast</h4>
<div class="listingblock">
<div class="title">Numerical weather prediction: WCMP2 MQTT link with additional properties</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "rel"  : "items",
  "type" : "application/geo+json",
  "title": "Real-time notifications",
  "href" : "mqtts://globalbroker.meteo.fr:8883",
  "channel": "origin/a/wis2/ca-eccc-msc/data/core/weather/prediction/forecast/medium-range/deterministic/global",
  "properties": {
    "model_run": {
       "type": "string",
       "title": "Model run",
       "enum": [
           "00",
           "12"
        ],
        "example": "00"
    },
    "forecast_hour": {
       "type": "string",
       "title": "Forecast hour",
        "example": "004"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Numerical weather prediction: WNM additional properties</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "properties": {
    "model_run": "00",
    "forecast_hour": "004"
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A data producer would extend WCMP2 and WNM as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WCMP2: add a link <code>properties</code> object for MQTT links, where each key of the link <code>properties</code> object is a <a href="https://json-schema.org/understanding-json-schema/reference/object#properties">JSON Schema property definition</a></p>
</li>
<li>
<p>WNM: add additional properties (key: value pairs) in the <code>properties</code> object as desired</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When implemented by a data producer, a data consumer can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>subscribe to real-time notifications to the given topic</p>
</li>
<li>
<p>perform client side filtering against all incoming WNMs with <code>properties.model_run = "00" and properties.forecast_hour = "004"</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A sample Python script can be found below.  The script connects to the MÃ©tÃ©o-France Global Broker, subscribed to weather notifications
from Environment and Climate Change Canada, Meteorological Service of Canada.  The script then performs client side filtering by
evaluating (for each WNM) the <code>properties.wigos_station_identifier</code> value to match a particular station (<code>0-20000-0-71628</code>).</p>
</div>
<div class="listingblock">
<div class="title">Sample Python script to perform client side filtering</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import json
from paho.mqtt import client as mqtt_client

broker = 'globalbroker.meteo.fr'
port = 8883
username = 'everyone'
password = 'everyone'
topic = 'cache/a/wis2/ca-eccc-msc/data/core/weather/surface-based-observations/synop'

wsi_to_filter = '0-20000-0-71628'


def connect_mqtt() -&gt; mqtt_client:
    def on_connect(client, userdata, flags, reason_code, properties):
        if reason_code == 0:
            print(f'Connected to {broker}')
        else:
            print(f'Failed to connect: {reason_code}')

    def on_log(client, userdata, level, message):
        print("LOG:", message)

    client = mqtt_client.Client(mqtt_client.CallbackAPIVersion.VERSION2,
                                client_id='s123')
    client.username_pw_set(username, password)
    client.on_connect = on_connect
    client.on_log = on_log
    client.tls_set(tls_version=2)
    client.connect(broker, port)

    return client


def subscribe(client: mqtt_client):
    def on_message(client, userdata, message):
        message_dict = json.loads(message.payload.decode())

        print('Performing client side filtering')
        wsi = message_dict['properties'].get('wigos_station_identifier')

        if wsi != wsi_to_filter:
            print(f'Topic: {message.topic}')
            print(f'Payload: {message.payload.decode()}')

    client.subscribe(topic)
    client.on_message = on_message


def run():
    client = connect_mqtt()
    subscribe(client)
    client.loop_forever()


if __name__ == '__main__':
    run()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_providing_a_requirements_specification_for_a_wis_2_0_node"><a class="anchor" href="#_providing_a_requirements_specification_for_a_wis_2_0_node"></a>3.9. Providing a requirements specification for a WIS 2.0 Node</h3>
<div class="paragraph">
<p>The below recipe provides user requirements specifications for the implementation of a WIS 2.0 Node.</p>
</div>
<div class="sect3">
<h4 id="_wis_2_0_node_user_requirements_specifications"><a class="anchor" href="#_wis_2_0_node_user_requirements_specifications"></a>3.9.1. WIS 2.0 Node - User requirements specifications</h4>
<div class="sect4">
<h5 id="_introduction_2"><a class="anchor" href="#_introduction_2"></a>3.9.1.1. Introduction</h5>
<div class="sect5">
<h6 id="_applicable_documents"><a class="anchor" href="#_applicable_documents"></a>Applicable Documents</h6>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"></th>
<th class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><strong>Document Title</strong></th>
<th class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><strong>Reference</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">AD-0</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><div class="content"><div class="paragraph">
<p>Manual on the WMO Information System, Volume II - WMO Information System 2.0</p>
</div></div></td>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock"><a href="https://library.wmo.int/idurl/4/68731" class="bare">https://library.wmo.int/idurl/4/68731</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_reference_documents"><a class="anchor" href="#_reference_documents"></a>Reference Documents</h6>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"></th>
<th class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><strong>Document Title</strong></th>
<th class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><strong>Reference</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">RD-0</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">Guide to the WMO Information System Volume II - WMO Information System 2.0</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock"><a href="https://library.wmo.int/idurl/4/69130" class="bare">https://library.wmo.int/idurl/4/69130</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">RD-1</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">Provisions for the Transition from the WMO Information System (WIS) 1.0 and Global Telecommunication System to WIS 2.0</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock"><a href="https://library.wmo.int/idurl/4/69050" class="bare">https://library.wmo.int/idurl/4/69050</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">RD-2</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">WMO Information System 2.0 Strategy</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock"><a href="https://library.wmo.int/doc_num.php?explnum_id=4620" class="bare">https://library.wmo.int/doc_num.php?explnum_id=4620</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">RD-3</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">WIS 2.0: How to define successful transition?</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock"><a href="https://wmo-teams.atlassian.net/wiki/spaces/WIS2/pages/301957121/WIS2.0+how+to+define+successful+Transition" class="bare">https://wmo-teams.atlassian.net/wiki/spaces/WIS2/pages/301957121/WIS2.0+how+to+define+successful+Transition</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_system_overview"><a class="anchor" href="#_system_overview"></a>3.9.1.2. System overview</h5>
<div class="sect5">
<h6 id="_system_context"><a class="anchor" href="#_system_context"></a>System Context</h6>
<div class="paragraph">
<p>The WIS 2.0 Node will be available to receive data from the upstream data production system, and to serve these data via the Internet to the WIS 2.0 environment.</p>
</div>
<div class="paragraph">
<p>The WIS 2.0 Node will be available to receive metadata and to serve these metadata via the Internet to the WIS 2.0 environment.</p>
</div>
<div class="paragraph">
<p>WIS 2.0 Global Brokers will subscribe to the WIS 2.0 Node, and will receive publication messages when data and metadata become available.</p>
</div>
<div class="paragraph">
<p><strong>WIS 2.0 Node</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Selected core and recommended data from upstream systems</p>
</li>
<li>
<p>Notification messages to WIS 2.0 Global Brokers</p>
</li>
<li>
<p>Selected core data to WIS 2.0 Global Caches</p>
</li>
<li>
<p>Subscription messages from WIS 2.0 Global Brokers</p>
</li>
<li>
<p>Remaining core data and recommended data to WIS 2.0 end users</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/wis2node-context-diagram.jpg" alt="WIS 2.0 Node context diagram" width="800">
</div>
<div class="title">Figure 7. WIS 2.0 Node context diagram</div>
</div>
</div>
<div class="sect5">
<h6 id="_external_interfaces"><a class="anchor" href="#_external_interfaces"></a>External Interfaces</h6>
<div class="paragraph">
<p>As identified in the context diagram above, the WIS 2.0 Node will have external interfaces with WIS 2.0 Global Brokers, and WIS 2.0 Global Caches. In each case, the communications will be via the Internet.</p>
</div>
<div class="paragraph">
<p>The Global Brokers will subscribe to the MQTT broker on the Node. This will be done using the standard MQTT secure port, 8883.</p>
</div>
<div class="paragraph">
<p>The Global Caches will retrieve core data from the Node by accessing the HTTP server on the Node.</p>
</div>
<div class="paragraph">
<p>End users will retrieve core data not retained by the Global Caches from the Node by accessing the HTTP server on the Node. End users will also retrieve recommended data from the Node by accessing the HTTP server on the Node, subject to appropriate access control.</p>
</div>
</div>
<div class="sect5">
<h6 id="_concepts_and_constraints"><a class="anchor" href="#_concepts_and_constraints"></a>Concepts and Constraints</h6>
<div class="paragraph">
<p>The WIS 2.0 Node will be compliant with the Manual on WMO Information System Volume II. WMO Information System 2.0 [AD-0].</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_user_requirements"><a class="anchor" href="#_user_requirements"></a>3.9.1.3. User requirements</h5>
<div class="paragraph">
<p>The purpose of the WIS 2.0 Node (hereafter, referred to as the Node) is to be available to receive data from the production system, and to serve these data via the Internet to the WIS 2.0 environment.</p>
</div>
<div class="paragraph">
<p>In order to reach this target, the following high-level user requirements need to be fulfilled:</p>
</div>
<div class="paragraph">
<p><strong><em>USR-0001</em></strong></p>
</div>
<div class="paragraph">
<p>The Node shall comply with the specification given in the Manual on WMO Information System Volume II. WMO Information System 2.0, [AD-0].</p>
</div>
<div class="paragraph">
<p><strong><em>USR-0101</em></strong></p>
</div>
<div class="paragraph">
<p>The WIS 2.0 Node shall include an MQTT broker, using MQTT 5.0 (hereafter, referred to as the Broker).</p>
</div>
<div class="paragraph">
<p><strong><em>USR-0150</em></strong></p>
</div>
<div class="paragraph">
<p>The Broker included in the Node shall be accessible via MQTT protocol over the Internet.</p>
</div>
<div class="paragraph">
<p><strong><em>USR-0201</em></strong></p>
</div>
<div class="paragraph">
<p>The Node will allow subscriptions from the WIS 2.0 Global Brokers.</p>
</div>
<div class="paragraph">
<p><strong><em>USR-0210</em></strong></p>
</div>
<div class="paragraph">
<p>The Node will restrict subscriptions to the Broker by only WIS 2.0 Global Brokers by filtering their incoming IP addresses as made available by WMO Secretariat.</p>
</div>
<div class="paragraph">
<p><strong><em>USR-0220</em></strong></p>
</div>
<div class="paragraph">
<p>Access to the Broker shall be password controlled.</p>
</div>
<div class="paragraph">
<p><strong><em>USR-230</em></strong></p>
</div>
<div class="paragraph">
<p>The secure version of MQTT (MQTTS) shall be used. The use of SSL certificates to support this shall be maintained over the lifetime of the system.</p>
</div>
<div class="paragraph">
<p><strong><em>USR-240</em></strong></p>
</div>
<div class="paragraph">
<p>The Broker shall publish messages using MQTTâs Quality of Service (QoS) level 1. This is defined as follows: â<em>The broker/client will deliver the message at least once, with confirmation required.</em>â.</p>
</div>
<div class="paragraph">
<p><strong><em>USR-0301</em></strong></p>
</div>
<div class="paragraph">
<p>Upon the arrival of data for distribution via WIS 2.0, the Broker shall publish an MQTT message announcing the availability of the data.</p>
</div>
<div class="paragraph">
<p><strong><em>USR-0320</em></strong></p>
</div>
<div class="paragraph">
<p>Notification messages published by the Node shall be formatted in geoJSON, in accordance with the Manual on WMO Information System Volume II. WMO Information System 2.0, [AD-0].</p>
</div>
<div class="paragraph">
<p><strong><em>USR-0340</em></strong></p>
</div>
<div class="paragraph">
<p>Notification messages published by the Node shall be published using an MQTT topic defined in accordance with the WIS 2.0 topic hierarchy.</p>
</div>
<div class="paragraph">
<p><strong><em>USR-0360</em></strong></p>
</div>
<div class="paragraph">
<p>The MQTT topic used in notification messages shall not be configured to retain messages.</p>
</div>
<div class="paragraph">
<p><strong><em>USR-0401</em></strong></p>
</div>
<div class="paragraph">
<p>The Node shall provide access to core data via HTTP over the Internet.</p>
</div>
<div class="paragraph">
<p><strong><em>USR-0450</em></strong></p>
</div>
<div class="paragraph">
<p>The Node shall provide access to recommended data via HTTP over the Internet, subject to appropriate access control.</p>
</div>
<div class="paragraph">
<p><strong><em>USR-0500</em></strong></p>
</div>
<div class="paragraph">
<p>The Node shall provide access to core data via HTTPS over the Internet.</p>
</div>
<div class="paragraph">
<p><strong><em>USR-0550</em></strong></p>
</div>
<div class="paragraph">
<p>The Node shall provide access to recommended data via HTTPS over the Internet, subject to appropriate access control.</p>
</div>
<div class="paragraph">
<p><strong><em>USR-0601</em></strong></p>
</div>
<div class="paragraph">
<p>The Node shall support the retrieval core data by the WIS 2.0 Global Caches.</p>
</div>
<div class="sect5">
<h6 id="_extract_from_the_manual_on_wmo_information_system_volume_ii_wmo_information_system_2_0_ad_0"><a class="anchor" href="#_extract_from_the_manual_on_wmo_information_system_volume_ii_wmo_information_system_2_0_ad_0"></a>Extract from the Manual on WMO Information System Volume II. WMO Information System 2.0 [AD-0]:</h6>
<div class="paragraph">
<p>FUNCTIONAL REQUIREMENTS OF A WIS NODE</p>
</div>
<div class="paragraph">
<p>3.6.1 General</p>
</div>
<div class="paragraph">
<p>3.6.1.1 A WIS Node is the component that enables an NC or DCPC to publish their data and discovery metadata via WIS.</p>
</div>
<div class="paragraph">
<p>3.6.1.2 See also 3.3 (Functional requirements of an NC) and 3.4 (Functional requirements of a DCPC).</p>
</div>
<div class="paragraph">
<p>3.6.2 Provide access to data and discovery metadata</p>
</div>
<div class="paragraph">
<p>3.6.2.1 A WIS Node shall provide access to data in accordance with the WMO Unified Data Policy (Resolution 1 (Cg-Ext-2021)).</p>
</div>
<div class="paragraph">
<p>3.6.2.2 A WIS Node shall allow one or more Global Caches to access and download core data it publishes for real-time and near real-time exchange. Global Caches provide highly available access to copies of these resources.</p>
</div>
<div class="paragraph">
<p>3.6.2.3 A WIS Node may restrict access to its core data, relying on Global Caches providing access to data consumers.</p>
</div>
<div class="paragraph">
<p>3.6.2.4 A WIS Node may provide access to data using a Web-based Application Programming Interface (API).</p>
</div>
<div class="paragraph">
<p>3.6.2.5 A WIS Node shall provide access to discovery metadata describing the data it makes available and how that data can be accessed. Discovery metadata from a WIS Node is added to the Global Discovery Catalogue to create a consolidated view of data available from all WIS Nodes.</p>
</div>
<div class="paragraph">
<p>3.6.2.6 A WIS Node shall have the capability to publish notifications via a Message Broker.</p>
</div>
<div class="paragraph">
<p>3.6.2.7 A WIS Node shall publish notifications via its Message Broker about updates to the data and discovery metadata it provides â including the availability of new data, changes to discovery metadata, and removal of a data set from WIS.</p>
</div>
<div class="paragraph">
<p>3.6.2.8 A WIS Node shall use a standardized topic structure when publishing notifications. Note: More information on the standardized topic structure is provided in the Guidance on technical specifications of WIS 2.0.</p>
</div>
<div class="paragraph">
<p>3.6.2.9 A WIS Node shall allow one or more Global Brokers to subscribe to notifications published via its Message Broker. Global Brokers provide highly available distribution of notifications published by a WIS Node.</p>
</div>
<div class="paragraph">
<p>3.6.2.10 See also 4.3 (WIS-TechSpec-2: Publishing data and discovery metadata).</p>
</div>
<div class="paragraph">
<p>Note: More information on the function and implementation of a WIS Node is provided in the Guidance on technical specifications of WIS 2.0.</p>
</div>
<div class="paragraph">
<p>3.6.3 Monitor performance of a WIS Node</p>
</div>
<div class="paragraph">
<p>3.6.3.1 Each WIS Node shall contribute to monitoring the performance of WIS.</p>
</div>
<div class="paragraph">
<p>3.6.3.2 See also 4.7 (WIS-TechSpec-6: Managing operations of the WIS).</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recipes_for_earth_system_discipline_domain_experts"><a class="anchor" href="#_recipes_for_earth_system_discipline_domain_experts"></a>4. Recipes for Earth system discipline domain experts</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_defining_and_proposing_topic_for_wmo_earth_system_disciplines"><a class="anchor" href="#_defining_and_proposing_topic_for_wmo_earth_system_disciplines"></a>4.1. Defining and proposing topic for WMO Earth system disciplines</h3>
<div class="paragraph">
<p>The <a href="https://wmo-im.github.io/wis2-topic-hierarchy/standard/wis2-topic-hierarchy-STABLE.html">WIS2 Topic Hierarchy</a> describes the topic structure and levels to be used when publishing WIS2 notification messages.</p>
</div>
<div class="paragraph">
<p>The purpose of this document is to provide guidelines to domain experts so that the Topic Hierarchy definition is consistent and useful to address the needs of WIS2 users.</p>
</div>
<div class="sect3">
<h4 id="_core_levels"><a class="anchor" href="#_core_levels"></a>4.1.1. Core levels</h4>
<div class="paragraph">
<p>Core topics are defined in the first 7 levels and address all Earth system disciplines in a consistent manner.</p>
</div>
<div class="ulist">
<div class="title">Core topic examples:</div>
<ul>
<li>
<p><code>cache/a/wis2/ma-marocmeteo/core/data/weather</code></p>
</li>
<li>
<p><code>origin/a/wis2/de-dwd/core/data/ocean</code></p>
</li>
<li>
<p><code>cache/a/wis2/jp-jma/core/data/weather</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Earth system disciplines <a href="https://codes.wmo.int/wis/topic-hierarchy/_earth-system-discipline">defined</a> by WTH are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>atmospheric-composition</code></p>
</li>
<li>
<p><code>climate</code></p>
</li>
<li>
<p><code>cryosphere</code></p>
</li>
<li>
<p><code>hydrology</code></p>
</li>
<li>
<p><code>ocean</code></p>
</li>
<li>
<p><code>space-weather</code></p>
</li>
<li>
<p><code>weather</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Topics within each Earth system discipline are then defined by domain experts, reviewed, approved, and published by WMO.</p>
</div>
</div>
<div class="sect3">
<h4 id="_additional_earth_domain_specific_topics_levels"><a class="anchor" href="#_additional_earth_domain_specific_topics_levels"></a>4.1.2. Additional Earth domain specific topics levels</h4>
<div class="sect4">
<h5 id="_what_is_the_use_of_the_topic_hierarchy"><a class="anchor" href="#_what_is_the_use_of_the_topic_hierarchy"></a>4.1.2.1. What is the use of the Topic Hierarchy ?</h5>
<div class="paragraph">
<p>The definition of the Topic Hierarchy is heavily linked to the use of Publish-Subscribe (Pub/Sub) protocols, here MQTT[S], in WIS2. Users, when subscribing to the Global Broker, can decide which notification messages they wish to receive.</p>
</div>
</div>
<div class="sect4">
<h5 id="_mqtt_wildcards"><a class="anchor" href="#_mqtt_wildcards"></a>4.1.2.2. MQTT wildcards</h5>
<div class="paragraph">
<p>For example, connecting to a Global Broker and subscribing to:</p>
</div>
<div class="paragraph">
<p><code>cache/a/wis2/+/core/data/weather/surface-weather-observation/synop</code></p>
</div>
<div class="paragraph">
<p>users will receive a notification when a new synop is made available from <strong>any</strong> centre-id publishing message on WIS2.  The <code>+</code> character is a single level wildcard for MQTT subscription.</p>
</div>
<div class="paragraph">
<p>A user can also choose to subscribe to:</p>
</div>
<div class="paragraph">
<p><code>cache/a/wis2/de-dwd/core/data/weather/#</code></p>
</div>
<div class="paragraph">
<p>In this case, users will receive notification messages from the <code>de-dwd</code> centre-id for <strong>all</strong> weather data.  The <code>#</code> character is a multiple level wildcard for MQTT subscription, and can only be used at the end of a topic subscription.</p>
</div>
<div class="paragraph">
<p>By using <code>+</code> and <code>#</code> (the two defined wildcards in the MQTT[S] protocol), users can extend their subscription and receive all messages they need.</p>
</div>
<div class="paragraph">
<p>The purpose of additional topic hierarchy levels is to allow users to get the messages they need and to be more specific in their request.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dos_and_donts_when_defining_earth_system_discipline_topics"><a class="anchor" href="#_dos_and_donts_when_defining_earth_system_discipline_topics"></a>4.1.3. Dos and don&#8217;ts when defining Earth system discipline topics</h4>
<div class="paragraph">
<p><strong>Define only a <em>small number</em> of additional levels</strong></p>
</div>
<div class="paragraph">
<p>According the the MQTT[S] protocol specification, the accepted length of a given topic is more than 65kB.  This means that the number of levels can be extremely large.  However, as explained in <a href="https://www.emqx.com/en/blog/advanced-features-of-mqtt-topics" class="bare">https://www.emqx.com/en/blog/advanced-features-of-mqtt-topics</a>:</p>
</div>
<div class="paragraph">
<p><em>Try not to use more topic levels âjust because I canâ. For example, <code>my-home/room1/data</code> is a better choice than <code>my/home/room1/data</code>.</em></p>
</div>
<div class="paragraph">
<p>By default, some MQTT brokers are configured to accept a maximum of 10 levels. This can be changed in the configuration of the broker, however, this limit shows that a usable, practical topic structure should not be too deep (i.e. with a large number of levels).</p>
</div>
<div class="paragraph">
<p>For WIS2, and considering the various Earth system disciplines, a limit of <strong>4</strong> sublevels seems appropriate.</p>
</div>
<div class="paragraph">
<p><strong>Do not use the topic as a metadata record</strong></p>
</div>
<div class="paragraph">
<p>When defining the topic, experts must focus on the needs of users.  The purpose of the WIS2 Topic Hierarchy is <strong>not</strong> to describe as precisely as possible what data users will obtain if they decide to subscribe and then download.  Rather, it is <em>only</em> to provide a filtering mechanism so that users will not be flooded by WIS2 Notification Messages that may not be useful for them.</p>
</div>
<div class="paragraph">
<p>In WIS2, all datasets <strong>must</strong> be described using the <a href="https://wmo-im.github.io/wcmp2/standard/wcmp2-STABLE.html">WMO Core Metadata Profile version 2(WCMP2)</a>.  Users will be able to discover the data they need by searching the WIS2 catalogue using (via search engines, directly, or from portals and applications).  The topic hierarchy information will be part of the metadata record for data which provides real-time notifications of publication.</p>
</div>
<div class="paragraph">
<p>*Do not allow locally defined sublevels outside the <code>experimental</code> topic</p>
</div>
<div class="paragraph">
<p>Each Earth system discipline provides an <code>experimental</code> topic.  For example, for <code>weather</code>, the first additional levels in the domain topic hierarchy are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock"><code>advisories-warnings</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">Advisories and warnings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock"><code>aviation</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">Aviation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock"><code>prediction</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">Data sets produced by quantitative algorithms, such as numerical or statistical prediction models, describing the past, present and future meteorological states</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock"><code>space-based-observations</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">Space based observations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock"><code>surface-based-observations</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">Surface based observations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock"><code>experimental</code></p></td>
<td class="tableblock halign-left valign-top" style="background-color: #FFFFFF;"><p class="tableblock">Experimental topics</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As the name suggests, <code>experimental</code> allows for defining additional topics for tests and experiments.  This is not meant to be used for operational data exchange.  It should only be used for testing purposes.</p>
</div>
<div class="paragraph">
<p>With the exclusion of the <code>experimental</code> topic level, the topic Hierarchy must be <em>fully</em> defined for each Earth system discipline.</p>
</div>
<div class="paragraph">
<p>In some situations, it might be tempting for a data producer to use additional topic levels to restrict even more the number of messages received by the users.</p>
</div>
<div class="paragraph">
<p>This is <strong>forbidden</strong>.</p>
</div>
<div class="paragraph">
<p>In each Earth system discipline community, all WIS Centres will be able to use the entire topic hierarchy of the domain if they provide data corresponding to each topic. A WIS Centre will not be allowed to add additional sublevels or undefined level within the Topic Hierarchy for its own needs.</p>
</div>
<div class="paragraph">
<p>Modification of the Topic Hierarchy will be possible by using the WMO fast-track approval process.</p>
</div>
<div class="paragraph">
<p><strong>Consider users needs and prevent complex wildcard subscriptions</strong></p>
</div>
<div class="paragraph">
<p>The purpose of the WIS2 Topic Hierarchy is to inform users about the availability of new data. In WIS2, obtaining data will start, in most cases, by configuring one or more subscription to topics, as defined in the associated WCMP2 discovery metadata records, so that users will receive notifications when new data is available.</p>
</div>
<div class="paragraph">
<p>The Topic Hierarchy should be defined so that users will not need to configure a very large number of different subscriptions to get the data they are interested in.</p>
</div>
<div class="paragraph">
<p>Each level in the WIS2 Topic Hierarchy should be seen as a "logical" group (as the Earth system disciplines <code>weather</code>, <code>ocean</code>&#8230;&#8203; or like <code>synop</code> for <code>surface-based-observations</code>).</p>
</div>
<div class="paragraph">
<p>Then, and considering that wildcard subscription (using <code>+`and `#</code> as described above), are "expensive" to manage for the brokers.</p>
</div>
<div class="paragraph">
<p>For example, a topic hierarchy resulting in users subscribing to:</p>
</div>
<div class="paragraph">
<p><code>cache/a/wis2/+/core/data/ocean/+/some/+/thing/+/else/#</code></p>
</div>
<div class="paragraph">
<p>should be avoided. A subscription to the following topic:</p>
</div>
<div class="paragraph">
<p><code>cache/a/wis2/+/core/data/ocean/some/thing/else/#</code></p>
</div>
<div class="paragraph">
<p>is much more effective for both the client and the broker side.</p>
</div>
<div class="paragraph">
<p>If it is likely that most users will use wildcards for particular topic levels, then, either removing that level altogether, of moving that level a the end of the topic hierarchy is also more efficient for clients and producers.</p>
</div>
<div class="paragraph">
<p>If most users end up subscribing to:</p>
</div>
<div class="paragraph">
<p><code>cache/a/wis2/+/core/data/ocean/+/thing/+/#</code></p>
</div>
<div class="paragraph">
<p>then, the Topic Hierarchy could be reconsidered, so that the above subscription can be replaced by:</p>
</div>
<div class="paragraph">
<p><code>cache/a/wis2/+/core/data/ocean/thing/#</code></p>
</div>
<div class="paragraph">
<p>Reordering the levels of topics and potentially reducing the number of sublevels makes the topic hierarchy simpler and more efficient.</p>
</div>
<div class="paragraph">
<p><strong>Facilitate client side filtering</strong></p>
</div>
<div class="paragraph">
<p>Notification messages are small pieces of information.  MQTT[S] broker and clients are able to handle a very large number of messages.  In that sense, receiving, potentially, too many messages is not a problem. However, downloading data, depending on the size of the data might be slower and less efficient.  If, for a particular dataset, the geometry information available in the notification message is not sufficient to allow client-side filtering before download, it is suggested to provide additional information in the <code>properties</code> object of the notification message so that users can decide <em>before</em> downloading if the data in this particular messsage is useful for them.</p>
</div>
<div class="paragraph">
<p>See <a href="#_advertise_client_side_filters_for_data_subscriptions_in_wcmp2_and_wnm">[_advertise_client_side_filters_for_data_subscriptions_in_wcmp2_and_wnm]</a> for more information on client side filtering</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wcmp2_extensions_creating_earth_system_discipline_domain_specific_profiles_of_wcmp2"><a class="anchor" href="#_wcmp2_extensions_creating_earth_system_discipline_domain_specific_profiles_of_wcmp2"></a>4.2. WCMP2 Extensions: creating Earth system discipline domain specific profiles of WCMP2</h3>
<div class="paragraph">
<p><a href="https://docs.ogc.org/is/20-004r1/20-004r1.html#clause-record-core">OGC API - Records - Part 1: Core: Requirements Class: Record Core</a> allows for extension and profiling of the metadata content model.  In this context, WCMP2 itself is a domain profile, as WMO&#8217;s discovery metadata standard for all Earth system disciplines.</p>
</div>
<div class="paragraph">
<p>As part of WIS2, Earth system discipline domain experts may choose to extend and profile WCMP2 to meet their specific needs.  Typical examples of where extensions can be useful include, but are not limited to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>further constraining specific WCMP2 properties (e.g. based on a controlled vocabulary)</p>
</li>
<li>
<p>enforcing optional WCMP2 properties to be required</p>
</li>
<li>
<p>adding new or additional properties to a WCMP2 record</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Profiling WCMP2 can enable domain communities achieve deeper interoperability (or tighter coupling) to meet their needs.  For example, an NWP profile of WCMP2 may drive a user-focused NWP portal which leverages domain specific properties of a WCMP2 record for more meaningful search results and assessment for use.</p>
</div>
<div class="sect3">
<h4 id="_considerations_for_creating_a_wcmp2_extension"><a class="anchor" href="#_considerations_for_creating_a_wcmp2_extension"></a>4.2.1. Considerations for creating a WCMP2 Extension</h4>
<div class="paragraph">
<p>Before creating an extension, domain experts need to give thought on the following aspects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>gap analysis in WCMP2: can existing WCMP2 properties be used?</p>
</li>
<li>
<p>use cases: consider how the additional properties (or constraints on existing) would be used (as a queryable, returnable, etc.)</p>
</li>
<li>
<p>sustainability: while developing a WCMP2 extension can be worthwhile metadata modelling exercise, ensure that there is a team in place to help maintain the extension over time.  This means having clear ownership of a WCMP2 extension that is subject to ongoing review, and supporting user questions, issues, enhancements and bug fixes</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_how_to_create_a_wcmp2_extension"><a class="anchor" href="#_how_to_create_a_wcmp2_extension"></a>4.2.2. How to create a WCMP2 Extension</h4>
<div class="paragraph">
<p>WCMP2 extensions can be defined on <a href="https://github.com/wmo-im/wcmp2-extensions">WMO&#8217;s GitHub repository for WCMP2 Extensions</a>.  Domains can identify and propose extensions as GitHub issues and Pull Requests, which are reviewed by <a href="https://github.com/wmo-im/tt-wismd">WMO TT-WISMD</a>:</p>
</div>
<div class="paragraph">
<p>The following elements are required for any WCMP2 extension:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>directory on GitHub repository, containing:</p>
<div class="ulist">
<ul>
<li>
<p>examples (directory <code>examples/</code>): a directory of example WCMP2 records exemplifying the extension</p>
</li>
<li>
<p>JSON Schema (directory <code>schema/</code>): a directory of the JSON Schema definition for the extension, encoded as YAML.  The JSON Schema definition should either refer to controlled vocabularies from existing online vocabularies or define inline as <code>enum</code> lists</p>
</li>
<li>
<p>README (file <code>README.md</code>): the WCMP2 Extension Specification, which includes:</p>
<div class="ulist">
<ul>
<li>
<p>owner: clear, unambiguous ownership identification of the Extension</p>
</li>
<li>
<p>prefix: prefix for all defined elements (i.e. <code>hydro:</code>, <code>nwp:</code>, etc.)</p>
</li>
<li>
<p>conformance: URI for conformance identification and usage in WCMP2 documents (<code>conformsTo</code> member)</p>
</li>
<li>
<p>maturity: level of maturity guideline for usage</p>
</li>
<li>
<p>definitions: specification of additional elements and their requirements (required/optional)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example directory structure</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">|__hydro
|____README.md
|____schema
| |____hydro-schema.yaml
|____examples
| |____example1.json
| |____example2.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>An example extension can be found at <a href="https://github.com/wmo-im/wcmp2-extensions/tree/main/example" class="bare">https://github.com/wmo-im/wcmp2-extensions/tree/main/example</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_differences_in_wcmp2_records_with_extensions"><a class="anchor" href="#_differences_in_wcmp2_records_with_extensions"></a>4.3. Differences in WCMP2 records with Extensions</h3>
<div class="paragraph">
<p>A WCMP2 record with a defined extension per above would provide the following in <code>conformsTo</code>:</p>
</div>
<div class="listingblock">
<div class="title">Example of identifying additional conformance for a WCMP2 Extension</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"conformsTo": [
    "http://wis.wmo.int/spec/wcmp/2/conf/core",
    "https://wmo-im.github.io/wcmp2-extensions/hydro"  # TODO: clarify how to best identify
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will allow a WCMP2 parser to detect additional conformance to a given Extension and validate accordingly (in addition to validating WCMP2 Core).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recipes_for_global_service_operators"><a class="anchor" href="#_recipes_for_global_service_operators"></a>5. Recipes for Global Service operators</h2>
<div class="sectionbody">

</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. <a href="https://community.wmo.int/governance/commission-membership/commission-observation-infrastructures-and-information-systems-infcom/commission-infrastructure-officers/infcom-management-group/standing-committee-information-management-and-technology-sc-imt" class="bare">https://community.wmo.int/governance/commission-membership/commission-observation-infrastructures-and-information-systems-infcom/commission-infrastructure-officers/infcom-management-group/standing-committee-information-management-and-technology-sc-imt</a>
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. <a href="https://community.wmo.int/governance/commission-membership/infcom" class="bare">https://community.wmo.int/governance/commission-membership/infcom</a>
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. <a href="https://www.go-fair.org/fair-principles/a2-metadata-accessible-even-data-no-longer-available/" class="bare">https://www.go-fair.org/fair-principles/a2-metadata-accessible-even-data-no-longer-available/</a>
</div>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. <a href="https://standards.iso.org/iso/19115/-3/mcc/1.0/codelists.html" class="bare">https://standards.iso.org/iso/19115/-3/mcc/1.0/codelists.html</a>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-10-10 22:14:30 UTC
</div>
</div>
</body>
</html>